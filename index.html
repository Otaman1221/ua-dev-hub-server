<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UA Dev Hub | Cloud Console</title>
    <style>
        :root { 
            --bg: #1a1b26; --panel: #16161e; --accent: #7aa2f7; 
            --text: #c0caf5; --border: #3b4261; --mine: #3d59a1; 
            --others: #24283b; --error: #f7768e; --success: #9ece6a;
            --sidebar-w: 70px;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR (–Ø–∫ —É –¥–µ—Å–∫—Ç–æ–ø—ñ) */
        #sidebar { width: var(--sidebar-w); background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 15px; }
        .nav-btn { background: transparent; color: #a9b1d6; font-size: 24px; border: none; cursor: pointer; padding: 12px; border-radius: 12px; transition: 0.2s; }
        .nav-btn:hover { background: #24283b; color: var(--accent); }
        .nav-btn.active { background: var(--mine); color: white; }
        .settings-btn { margin-top: auto; margin-bottom: 20px; opacity: 0.5; }
        .settings-btn:hover { opacity: 1; }

        /* MAIN AREA */
        #main-container { flex: 1; display: flex; flex-direction: column; }
        
        /* HEADER */
        #header { height: 55px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 25px; justify-content: space-between; }
        .status-info { display: flex; align-items: center; gap: 8px; font-size: 12px; }
        #status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--error); }

        /* CHAT AREA */
        #messages { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 12px; }
        .bubble { max-width: 70%; padding: 12px 16px; border-radius: 15px; font-size: 14px; position: relative; line-height: 1.5; border: 1px solid var(--border); }
        .mine { align-self: flex-end; background: var(--mine); border-bottom-right-radius: 2px; }
        .others { align-self: flex-start; background: var(--others); border-bottom-left-radius: 2px; }
        .u-name { font-size: 10px; font-weight: bold; color: #bb9af7; display: block; margin-bottom: 4px; }
        .time { font-size: 9px; color: #565f89; text-align: right; display: block; margin-top: 5px; }

        /* INPUT AREA (–Ø–∫ —É –¥–µ—Å–∫—Ç–æ–ø—ñ) */
        #input-area { background: var(--panel); padding: 15px 25px; display: flex; gap: 12px; border-top: 1px solid var(--border); align-items: center; }
        input { flex: 1; background: #24283b; border: 1px solid var(--border); color: white; padding: 12px 20px; border-radius: 25px; outline: none; }
        #send-btn { background: var(--accent); border: none; width: 42px; height: 42px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #1a1b26; }
        
        /* MODAL FOR TOKEN */
        #token-modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; }
        .modal-content { background: var(--panel); padding: 30px; border-radius: 15px; border: 1px solid var(--border); width: 400px; text-align: center; }
    </style>
</head>
<body>

    <div id="sidebar">
        <button class="nav-btn" title="–†–æ–±–æ—á–∞ –∑–æ–Ω–∞">üõ†</button>
        <button class="nav-btn active" title="–ß–∞—Ç">üí¨</button>
        <button class="nav-btn" title="–†–æ–∑–¥—ñ–ª–µ–Ω–∏–π –µ–∫—Ä–∞–Ω">üåì</button>
        <button class="nav-btn settings-btn" onclick="openTokenModal()">‚öôÔ∏è</button>
    </div>

    <div id="main-container">
        <div id="header">
            <span style="font-weight: bold; color: var(--accent);">üí¨ –ö–æ–º–∞–Ω–¥–Ω–∏–π —á–∞—Ç</span>
            <div class="status-info">
                <div id="status-dot"></div>
                <span id="status-text" style="color: #565f89;">–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è...</span>
            </div>
            <button onclick="clearCloudChat()" style="background: transparent; border: 1px solid var(--error); color: var(--error); padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 11px;">–û–ß–ò–°–¢–ò–¢–ò</button>
        </div>

        <div id="messages"></div>

        <div id="input-area">
            <input type="text" id="msgIn" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...">
            <button id="send-btn" onclick="sendToCloud()">‚û§</button>
        </div>
    </div>

    <div id="token-modal">
        <div class="modal-content">
            <h3 style="color: var(--accent);">–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è GitHub</h3>
            <p style="font-size: 12px; color: #565f89;">–í–≤–µ–¥—ñ—Ç—å –≤–∞—à —Ç–æ–∫–µ–Ω –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏.</p>
            <input type="password" id="tokenInput" style="width: 80%; margin-bottom: 20px;" placeholder="ghp_...">
            <br>
            <button onclick="saveToken()" style="padding: 10px 30px; border-radius: 10px; background: var(--accent); border: none; cursor: pointer;">–ó–ë–ï–†–ï–ì–¢–ò</button>
        </div>
    </div>

    <script>
        const CFG = {
            REPO: "Otaman1221/ua-dev-hub-server",
            FILE: "db/chat.json",
            USER: "Otaman1221"
        };

        let currentSHA = "";
        let GITHUB_TOKEN = localStorage.getItem('gh_token') || "";

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        window.onload = () => {
            if (!GITHUB_TOKEN) {
                openTokenModal();
            } else {
                setInterval(loadCloudMessages, 4000);
                loadCloudMessages();
            }
        };

        function openTokenModal() { document.getElementById('token-modal').style.display = 'flex'; }
        
        function saveToken() {
            const val = document.getElementById('tokenInput').value.trim();
            if (val) {
                localStorage.setItem('gh_token', val);
                GITHUB_TOKEN = val;
                document.getElementById('token-modal').style.display = 'none';
                location.reload();
            }
        }

        async function gitAPI(method, body = null) {
            const url = `https://api.github.com/repos/${CFG.REPO}/contents/${CFG.FILE}`;
            const headers = { "Authorization": `token ${GITHUB_TOKEN}`, "Accept": "application/vnd.github.v3+json" };
            const options = { method, headers };
            if (body) options.body = JSON.stringify(body);
            
            const res = await fetch(url, options);
            if (res.status === 401) {
                alert("–¢–æ–∫–µ–Ω –Ω–µ–¥—ñ–π—Å–Ω–∏–π! –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
                localStorage.removeItem('gh_token');
                openTokenModal();
                return null;
            }
            return res.json();
        }

        async function loadCloudMessages() {
            try {
                const data = await gitAPI("GET");
                if (!data || data.sha === currentSHA) return;
                
                currentSHA = data.sha;
                const msgs = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                
                const container = document.getElementById('messages');
                container.innerHTML = msgs.map(m => `
                    <div class="bubble ${m.user === CFG.USER ? 'mine' : 'others'}">
                        ${m.user !== CFG.USER ? `<span class="u-name">${m.user}</span>` : ''}
                        <div>${m.text}</div>
                        <span class="time">${m.time || ''}</span>
                    </div>
                `).join('');
                container.scrollTop = container.scrollHeight;
                
                document.getElementById('status-dot').style.background = 'var(--success)';
                document.getElementById('status-text').innerText = "üü¢ –•–º–∞—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞";
                document.getElementById('status-text').style.color = "var(--success)";
            } catch (e) {
                document.getElementById('status-dot').style.background = 'var(--error)';
                document.getElementById('status-text').innerText = "üî¥ –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó";
            }
        }

        async function sendToCloud() {
            const input = document.getElementById('msgIn');
            if (!input.value.trim()) return;
            const text = input.value; input.value = '';

            const file = await gitAPI("GET");
            const msgs = JSON.parse(decodeURIComponent(escape(atob(file.content))));
            msgs.push({
                user: CFG.USER,
                text: text,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            });

            const content = btoa(unescape(encodeURIComponent(JSON.stringify(msgs, null, 4))));
            await gitAPI("PUT", { message: "Web Cloud Sync", content: content, sha: file.sha });
            loadCloudMessages();
        }

        async function clearCloudChat() {
            if(!confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—é —Ö–º–∞—Ä–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é?")) return;
            const file = await gitAPI("GET");
            await gitAPI("PUT", { message: "Clear History", content: btoa("W10="), sha: file.sha });
            loadCloudMessages();
        }

        document.getElementById('msgIn').addEventListener('keypress', e => e.key === 'Enter' && sendToCloud());
    </script>
</body>
</html>