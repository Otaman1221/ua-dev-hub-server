<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UA Dev Hub | Cloud Workspace</title>
    <style>
        :root { 
            --bg: #1a1b26; 
            --panel: #16161e; 
            --accent: #7aa2f7; 
            --text: #c0caf5; 
            --bubble-me: #3d59a1; 
            --bubble-them: #24283b; 
            --border: #3b4261; 
            --error: #f7768e;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR */
        #sidebar { width: 70px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px; }
        .nav-btn { background: transparent; color: #a9b1d6; font-size: 24px; border: none; cursor: pointer; padding: 12px; border-radius: 12px; transition: 0.3s; }
        .nav-btn:hover { background: #24283b; color: var(--accent); }
        .nav-btn.active { background: #3d59a1; color: white; }

        /* –û–°–ù–û–í–ù–ò–ô –ö–û–ù–¢–ï–ù–¢ */
        #main-container { flex: 1; display: flex; flex-direction: column; }
        #header { height: 60px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 25px; justify-content: space-between; }
        
        .view { display: none; flex: 1; width: 100%; height: 100%; overflow: hidden; }
        .view.active { display: flex; }

        /* –†–û–ë–û–ß–ê –ó–û–ù–ê */
        #work-view { flex-direction: column; align-items: center; justify-content: center; text-align: center; }

        /* –ú–ï–°–ï–ù–î–ñ–ï–† */
        #chat-view { flex-direction: column; position: relative; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .bubble { max-width: 70%; padding: 12px 16px; border-radius: 15px; font-size: 14px; position: relative; line-height: 1.4; border: 1px solid var(--border); }
        .mine { align-self: flex-end; background: var(--bubble-me); border-bottom-right-radius: 2px; }
        .others { align-self: flex-start; background: var(--bubble-them); border-bottom-left-radius: 2px; }
        .u-name { font-size: 10px; font-weight: bold; color: #bb9af7; display: block; margin-bottom: 4px; }
        
        /* –ü–ê–ù–ï–õ–¨ –í–í–û–î–£ */
        #input-area { background: var(--panel); padding: 15px 25px; display: flex; gap: 12px; border-top: 1px solid var(--border); align-items: center; }
        input { flex: 1; background: #24283b; border: 1px solid var(--border); color: white; padding: 12px 20px; border-radius: 25px; outline: none; }
        input:focus { border-color: var(--accent); }
        #send-btn { background: var(--accent); border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* –†–û–ó–î–Ü–õ–ï–ù–ò–ô –ï–ö–†–ê–ù */
        #split-view { flex-direction: row; }
        #split-left { flex: 1.5; border-right: 1px solid var(--border); display: flex; align-items: center; justify-content: center; }
        #split-right { flex: 1; display: flex; flex-direction: column; }
    </style>
</head>
<body>

    <div id="sidebar">
        <button class="nav-btn active" onclick="switchView(0, this)" title="–†–æ–±–æ—á–∞ –∑–æ–Ω–∞">üõ†</button>
        <button class="nav-btn" onclick="switchView(1, this)" title="–ß–∞—Ç">üí¨</button>
        <button class="nav-btn" onclick="switchView(2, this)" title="–†–æ–∑–¥—ñ–ª–µ–Ω–∏–π –µ–∫—Ä–∞–Ω">üåì</button>
    </div>

    <div id="main-container">
        <div id="header">
            <span style="font-weight: bold; color: var(--accent);">UA DEV HUB | SERVER</span>
            <span id="status" style="font-size: 12px; color: #565f89;">–ó'—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é...</span>
            <button onclick="clearChat()" style="background: transparent; border: 1px solid var(--error); color: var(--error); padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 11px;">–û–ß–ò–°–¢–ò–¢–ò –ë–î</button>
        </div>

        <div id="work-view" class="view active">
            <h1 style="color: var(--accent);">üõ† –†–æ–±–æ—á–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä</h1>
            <p>–ü—Ä–æ—î–∫—Ç –ê–Ω–¥—Ä—ñ—è –ë–∞—à–∞–∫–∞ (Otaman1221)</p>
            <p style="color: #565f89;">–í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ –ª–æ–∫–∞–ª—å–Ω–æ—ó SQLite</p>
        </div>

        <div id="chat-view" class="view">
            <div id="chat-container" style="display: flex; flex-direction: column; width: 100%; height: 100%;">
                <div id="messages"></div>
                <div id="input-area">
                    <input type="text" id="msgIn" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö...">
                    <button id="send-btn" onclick="sendMsg()">‚û§</button>
                </div>
            </div>
        </div>

        <div id="split-view" class="view">
            <div id="split-left"><h3>üõ† –†–æ–±–æ—á–∞ –∑–æ–Ω–∞ (SQL Viewer)</h3></div>
            <div id="split-right"></div>
        </div>
    </div>

    <script>
        // –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –¥–ª—è –≤–µ–±-–≤–µ—Ä—Å—ñ—ó
        const CURRENT_USER = "Andriy Bashak";
        const API_URL = "http://127.0.0.1:5000/api/messages";
        const chatWidget = document.getElementById('chat-container');

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –≤–∫–ª–∞–¥–æ–∫
        function switchView(idx, btn) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            const views = [document.getElementById('work-view'), document.getElementById('chat-view'), document.getElementById('split-view')];
            views[idx].classList.add('active');

            if (idx === 1) views[idx].appendChild(chatWidget);
            if (idx === 2) document.getElementById('split-right').appendChild(chatWidget);
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑ –±–∞–∑–∏ —á–µ—Ä–µ–∑ Flask
        async function load() {
            try {
                const res = await fetch(API_URL);
                if (!res.ok) throw new Error("–°–µ—Ä–≤–µ—Ä –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î");
                const msgs = await res.json();
                
                const container = document.getElementById('messages');
                container.innerHTML = msgs.map(m => `
                    <div class="bubble ${m.user === CURRENT_USER ? 'mine' : 'others'}">
                        ${m.user !== CURRENT_USER ? `<span class="u-name">${m.user}</span>` : ''}
                        ${m.text}
                        <span style="font-size:9px; color:#565f89; display:block; text-align:right; margin-top:5px;">${m.time}</span>
                    </div>
                `).join('');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–æ–Ω–∏–∑—É
                container.scrollTop = container.scrollHeight;
                document.getElementById('status').innerText = "üü¢ –û–Ω–ª–∞–π–Ω (–ë–∞–∑–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∞)";
                document.getElementById('status').style.color = "#9ece6a";
            } catch (e) {
                document.getElementById('status').innerText = "üî¥ API —Å–µ—Ä–≤–µ—Ä –≤–∏–º–∫–Ω–µ–Ω–∏–π";
                document.getElementById('status').style.color = "#f7768e";
            }
        }

        // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –±–∞–∑—É —á–µ—Ä–µ–∑ Flask
        async function sendMsg() {
            const input = document.getElementById('msgIn');
            const text = input.value.trim();
            if (!text) return;

            const msgData = {
                user: CURRENT_USER,
                text: text
            };

            input.value = '';

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(msgData)
                });
                
                if (response.ok) {
                    load(); // –ú–∏—Ç—Ç—î–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
                }
            } catch (e) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:", e);
                alert("–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –∑–∞–ø—É—â–µ–Ω–æ app.py");
            }
        }

        // –û—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—î—ó –±–∞–∑–∏ —á–µ—Ä–µ–∑ –≤–µ–±
        async function clearChat() {
            if(!confirm("–£–í–ê–ì–ê! –¶–µ –≤–∏–¥–∞–ª–∏—Ç—å –í–°–Æ —ñ—Å—Ç–æ—Ä—ñ—é –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ –±–∞–∑–∏ SQLite. –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?")) return;
            
            try {
                // –í–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π –º–∞—Ä—à—Ä—É—Ç DELETE —É Flask –¥–ª—è —Ü—å–æ–≥–æ
                // –ê–±–æ –ø–æ–∫–∏ —â–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ POST –∑—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–º —Ñ–ª–∞–≥–æ–º
                alert("–§—É–Ω–∫—Ü—ñ—è –æ—á–∏—â–µ–Ω–Ω—è –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ Flask API");
            } catch (e) {
                console.error(e);
            }
        }

        // –û–±—Ä–æ–±–∫–∞ –∫–ª–∞–≤—ñ—à—ñ Enter
        document.getElementById('msgIn').addEventListener('keypress', e => {
            if (e.key === 'Enter') sendMsg();
        });

        // –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞ –∫–æ–∂–Ω—ñ 3 —Å–µ–∫—É–Ω–¥–∏
        setInterval(load, 3000);
        
        // –ü–æ—á–∞—Ç–∫–æ–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
        load();
    </script>
</body>
</html>